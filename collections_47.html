<html dir="ltr"> <head>
<title>Scala 2.8 コレクション API -- Scala 2.7 からの移行</title>

<style type="text/css">.maketitle {
  /* align: center; */
}
div.abstract {
  margin-left: 20%;
  margin-right: 10%;
}
h3.abstract {
  /* align: center; */
}
div.verse, div.quote, div.quotation {
  margin-left: 10%;
  margin-right: 10%;
}
</style>
<link rel="stylesheet" type="text/css" href="collections.css" />

</head> 
<body dir="ltr"> 
<table width="100%" cellpadding="0" cellspacing="2"><tr> <td bgcolor="#99ccff"><a href="collections_48.html"><img border="0" alt="謝辞" src="next.png"></a></td><td bgcolor="#99ccff"><a href="collections_0.html"><img border="0" alt="トップ" src="up.png"></a></td><td bgcolor="#99ccff"><a href="collections_46.html"><img border="0" alt="Java と Scala 間のコレクションの変換" src="previous.png"></a></td><td align="center" bgcolor="#99ccff" width="100%"><b>Scala 2.7 からの移行</b></td><td bgcolor="#99ccff" align="center"><a href="collections_49.html">目次</a></td></tr></table> 
<h1>Scala 2.7 からの移行</h1>
<p>既存の Scala アプリケーションの新しいコレクションへの移植はほぼ自動的であるはずだ．問題となり得ることはいくつかしかない．<p>一般的論として，Scala 2.7 コレクションの古い機能はそのまま残っているはずだ．機能の中には廃止予定となったものもあり，それは今後のリリースで撤廃されるということだ．Scala 2.8 でそのような機能を使ったコードをコンパイルすると<em>廃止予定警告</em>が発生する．その意味や性能特性を変えて 2.8 に残った演算もあり，その場合は廃止予定にするのは無理だった．このような場合は 2.8 でコンパイルすると<em>移行警告</em>が出される．コードをどう変えればいいのかも提案してくれる完全な廃止予定警告と移行警告を得るには，<tt>-deprecation</tt> と <tt>-Xmigration</tt> フラグを <tt>scalac</tt> に渡す (<tt>-Xmigration</tt> は <tt>X</tt> で始まるため，拡張オプションであることに注意)．同じオプションを <tt>scala</tt> REPL に渡すことで対話セッション上で警告を得ることができる．具体例としては:
<div class="quote"><p><tt></tt><table cellspacing="1" cellpadding="0"><tt></tt><tr><tt> </tt><td colspan="99" align="left"><tt>&gt;scala -deprecation -<font color="#660099">Xmigration</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">Welcome to Scala version 2.8.0.final</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">Type in expressions to have them evaluated.</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">Type :help for more information.</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>scala&gt; <font color="#0000e5">val</font> xs = <font color="#660099">List</font>((<font color="#000000">1</font>, <font color="#000000">2</font>), (<font color="#000000">3</font>, <font color="#000000">4</font>))</tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">xs: List[(Int, Int)] = List((1,2), (3,4))</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>scala&gt; List.unzip(xs)</tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">&lt;console&gt;:7: warning: method unzip in object List is deprecated: use xs.unzip instead of List.unzip(xs)</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">       List.unzip(xs)</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">            ^</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">res0: (List[Int], List[Int]) = (List(1, 3),List(2, 4))</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>scala&gt; xs.unzip</tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">res1: (List[Int], List[Int]) = (List(1, 3),List(2, 4))</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>scala&gt; <font color="#0000e5">val</font> m = xs.toMap</tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">m: scala.collection.immutable.</font></tt><tt><font color="#590000">Map[Int,Int] = Map((1,2), (3,4))</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt>scala&gt; m.keys</tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">&lt;console&gt;:8: warning: method keys in trait MapLike has changed semantics:</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">As of 2.8, keys returns Iterable[A] rather than Iterator[A].</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">       m.keys</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">         ^</font></tt></td></tr><tt> </tt><tr><tt> </tt><td colspan="99" align="left"><tt><font color="#590000">res2: Iterable[Int] = Set(1, 3) </font></tt></td></tr></table><tt> </tt></p></div>
<p>旧ライブラリより完全に置き換えられ，廃止予定警告を出すのが無理だったものが 2つある．<ol><li>以前の <tt>scala.collection.jcl</tt> パッケージは撤廃された． このパッケージは Scala 上で Java コレクションライブラリの設計を真似しようとしたが，それは多くの対称性を壊してしまった．Java コレクションが欲しい人の多くは <tt>jcl</tt> を飛ばして <tt>java.util</tt> を直接使用していた．Scala 2.8 は，<tt>jcl</tt> パッケージの代わりに，<a href="collections_46.html"><tt>JavaConversions</tt> オブジェクト</a>にて両方のライブラリ間の自動変換機構を提供する．<li>投射 (projection) は一般化され，きれいにされ，現在はビューとして提供される．投射はほとんど使われていなかったようなので，この変更に影響を受けるコードは少ないはずだ．</li></li></ol> <p>よって，<tt>jcl</tt> か投射を使っている場合は多少コードの書き換えが必要になるかもしれない．
<p>次へ: <a href="collections_48.html">謝辞</a> <hr> 
<table width="100%" cellpadding="0" cellspacing="2"><tr> <td bgcolor="#99ccff"><a href="collections_48.html"><img border="0" alt="謝辞" src="next.png"></a></td><td bgcolor="#99ccff"><a href="collections_0.html"><img border="0" alt="トップ" src="up.png"></a></td><td bgcolor="#99ccff"><a href="collections_46.html"><img border="0" alt="Java と Scala 間のコレクションの変換" src="previous.png"></a></td><td align="center" bgcolor="#99ccff" width="100%"><b>Scala 2.7 からの移行</b></td><td bgcolor="#99ccff" align="center"><a href="collections_49.html">目次</a></td></tr></table>
</body>
</html>
